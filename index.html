<html class="scroll-smooth" dir="ltr" lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>
   BULLA Top Up - Responsive Firebase eCommerce
  </title>
  <script src="https://cdn.tailwindcss.com">
  </script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&amp;display=swap" rel="stylesheet"/>
  <style>
   body {
    font-family: 'Inter', sans-serif;
  }
  </style>
 </head>
 <body class="bg-gray-50 min-h-screen flex flex-col">
  <!-- Navbar -->
  <header class="bg-white shadow sticky top-0 z-50">
   <nav class="container mx-auto flex items-center justify-between p-4">
    <a class="flex items-center space-x-2" href="#">
     <img alt="BULLA Top Up main logo, stylized letter B in blue and white" class="w-10 h-10" height="40" src="https://storage.googleapis.com/a1aa/image/8cd3c488-6250-4042-fcdd-6a77afa60733.jpg" width="40"/>
     <span class="font-bold text-xl text-blue-700">
      BULLA Top Up
     </span>
    </a>
    <ul class="hidden md:flex space-x-6 font-semibold text-gray-700 text-sm uppercase tracking-wide" id="nav-menu">
     <li>
      <a class="hover:text-blue-600" href="#profile">
       My Profile
      </a>
     </li>
     <li>
      <a class="hover:text-blue-600 relative" href="#orders">
       My Orders
       <span class="absolute -top-2 -right-3 bg-red-600 text-white rounded-full text-xs w-5 h-5 flex items-center justify-center hidden" id="order-notification-badge">
        0
       </span>
      </a>
     </li>
     <li>
      <a class="hover:text-blue-600" href="#wallet">
       My Wallet
      </a>
     </li>
     <li>
      <a class="hover:text-blue-600" href="#add-money">
       Add Money
      </a>
     </li>
    </ul>
    <button aria-label="Toggle menu" class="md:hidden text-gray-700 focus:outline-none" id="mobile-menu-btn">
     <i class="fas fa-bars fa-lg">
     </i>
    </button>
   </nav>
   <div class="md:hidden bg-white border-t border-gray-200 hidden" id="mobile-menu">
    <ul class="flex flex-col p-4 space-y-3 font-semibold text-gray-700 uppercase tracking-wide">
     <li>
      <a class="block hover:text-blue-600" href="#profile">
       My Profile
      </a>
     </li>
     <li>
      <a class="block hover:text-blue-600 relative" href="#orders">
       My Orders
       <span class="absolute top-1 right-4 bg-red-600 text-white rounded-full text-xs w-5 h-5 flex items-center justify-center hidden" id="order-notification-badge-mobile">
        0
       </span>
      </a>
     </li>
     <li>
      <a class="block hover:text-blue-600" href="#wallet">
       My Wallet
      </a>
     </li>
     <li>
      <a class="block hover:text-blue-600" href="#add-money">
       Add Money
      </a>
     </li>
    </ul>
   </div>
  </header>
  <main class="flex-grow container mx-auto px-4 py-8 max-w-5xl">
   <!-- Home Page -->
   <section class="text-center mb-12" id="home">
    <img alt="BULLA Top Up main logo, stylized letter B in blue and white, centered" class="mx-auto mb-4" height="120" loading="lazy" src="https://storage.googleapis.com/a1aa/image/d5e53a4a-c16d-4a16-fe12-0d430c20b1bd.jpg" width="120"/>
    <h1 class="text-4xl font-extrabold text-blue-700 tracking-wide mb-8">
     TOP UP
    </h1>
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-8 max-w-4xl mx-auto">
     <a aria-label="Free Fire ID CODE category" class="group block bg-white rounded-lg shadow hover:shadow-lg transition p-4" href="#category-FreeFire">
      <img alt="Free Fire ID CODE category image showing a mobile game character with fiery background" class="rounded-md mb-3 w-full object-cover h-40" height="200" loading="lazy" src="https://storage.googleapis.com/a1aa/image/1faad7c6-2b2a-41e7-6d37-41ca59fcb622.jpg" width="300"/>
      <h2 class="text-lg font-semibold text-gray-800 group-hover:text-blue-600">
       Free Fire (ID CODE) →
      </h2>
     </a>
     <a aria-label="Airdrop Offer category" class="group block bg-white rounded-lg shadow hover:shadow-lg transition p-4" href="#category-AirdropOffer">
      <img alt="Airdrop Offer category image showing coins dropping from the sky with a blue background" class="rounded-md mb-3 w-full object-cover h-40" height="200" loading="lazy" src="https://storage.googleapis.com/a1aa/image/6210053d-577a-490c-9067-65eb7c937ef9.jpg" width="300"/>
      <h2 class="text-lg font-semibold text-gray-800 group-hover:text-blue-600">
       Airdrop Offer →
      </h2>
     </a>
     <a aria-label="Weekly &amp; Monthly category" class="group block bg-white rounded-lg shadow hover:shadow-lg transition p-4" href="#category-WeeklyMonthly">
      <img alt="Weekly and Monthly category image showing calendar pages with coins and gift boxes" class="rounded-md mb-3 w-full object-cover h-40" height="200" loading="lazy" src="https://storage.googleapis.com/a1aa/image/53921f8b-92b6-46bf-414c-02b58116c367.jpg" width="300"/>
      <h2 class="text-lg font-semibold text-gray-800 group-hover:text-blue-600">
       Weekly &amp; Monthly →
      </h2>
     </a>
    </div>
   </section>
   <!-- Category Pages Container -->
   <section class="hidden max-w-3xl mx-auto bg-white rounded-lg shadow p-6" id="category-container">
    <button aria-label="Back to home categories" class="mb-6 text-blue-600 hover:underline flex items-center space-x-2" id="category-back-btn">
     <i class="fas fa-arrow-left">
     </i>
     <span>
      Back to Categories
     </span>
    </button>
    <h2 class="text-2xl font-bold mb-4 text-center text-blue-700" id="category-title">
    </h2>
    <form class="mb-6 flex flex-col sm:flex-row sm:items-center sm:space-x-4" id="uid-form">
     <label class="mb-2 sm:mb-0 font-semibold text-gray-700" for="uid-input">
      Enter UID:
     </label>
     <input aria-describedby="uid-error" class="flex-grow border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" id="uid-input" name="uid" placeholder="Enter your game UID" required="" type="text"/>
     <button class="mt-3 sm:mt-0 bg-blue-600 text-white px-5 py-2 rounded hover:bg-blue-700 transition" type="submit">
      Load Products
     </button>
    </form>
    <p class="text-red-600 text-sm mb-4 hidden" id="uid-error" role="alert">
    </p>
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-6" id="product-list">
    </div>
   </section>
   <!-- Wallet & Add Money Section -->
   <section class="hidden max-w-3xl mx-auto bg-white rounded-lg shadow p-6 space-y-6" id="wallet-section">
    <h2 class="text-2xl font-bold text-blue-700 mb-4 text-center">
     My Wallet
    </h2>
    <div class="text-center text-lg font-semibold text-gray-800">
     Balance:
     <span id="wallet-balance">
      ৳0.00
     </span>
    </div>
    <form class="flex flex-col sm:flex-row sm:items-center sm:space-x-4 justify-center" id="add-money-form">
     <label class="mb-2 sm:mb-0 font-semibold text-gray-700" for="add-money-amount">
      Add Money (৳):
     </label>
     <input class="border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 w-full sm:w-40" id="add-money-amount" min="10" name="amount" placeholder="Minimum 10" required="" step="1" type="number"/>
     <button class="mt-3 sm:mt-0 bg-green-600 text-white px-5 py-2 rounded hover:bg-green-700 transition" type="submit">
      Add Money
     </button>
    </form>
    <p class="text-green-600 text-center font-semibold hidden" id="add-money-msg">
    </p>
   </section>
   <!-- Orders Section -->
   <section class="hidden max-w-5xl mx-auto bg-white rounded-lg shadow p-6" id="orders-section">
    <h2 class="text-2xl font-bold text-blue-700 mb-6 text-center">
     My Orders
    </h2>
    <div class="overflow-x-auto">
     <table class="w-full text-left border-collapse">
      <thead>
       <tr class="bg-blue-100 text-blue-800 uppercase text-sm font-semibold">
        <th class="p-3 border border-blue-200">
         Order ID
        </th>
        <th class="p-3 border border-blue-200">
         Product
        </th>
        <th class="p-3 border border-blue-200">
         UID
        </th>
        <th class="p-3 border border-blue-200">
         Amount (৳)
        </th>
        <th class="p-3 border border-blue-200">
         Status
        </th>
        <th class="p-3 border border-blue-200">
         Order Date
        </th>
       </tr>
      </thead>
      <tbody class="text-gray-700" id="orders-list">
      </tbody>
     </table>
    </div>
   </section>
   <!-- Profile Section -->
   <section class="hidden max-w-3xl mx-auto bg-white rounded-lg shadow p-6 space-y-4" id="profile-section">
    <h2 class="text-2xl font-bold text-blue-700 mb-4 text-center">
     My Profile
    </h2>
    <div class="flex flex-col space-y-3">
     <div>
      <label class="block font-semibold text-gray-700 mb-1">
       Name
      </label>
      <input class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" id="profile-name" readonly="" type="text"/>
     </div>
     <div>
      <label class="block font-semibold text-gray-700 mb-1">
       Email
      </label>
      <input class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" id="profile-email" readonly="" type="email"/>
     </div>
     <button class="bg-red-600 text-white px-5 py-2 rounded hover:bg-red-700 transition w-full" id="logout-btn">
      Logout
     </button>
    </div>
   </section>
   <!-- Promo Code & Reviews Section -->
   <section class="max-w-5xl mx-auto mt-12 space-y-12" id="promo-reviews-faq">
    <!-- Promo Code -->
    <div class="bg-white rounded-lg shadow p-6 max-w-md mx-auto">
     <h3 class="text-xl font-bold text-blue-700 mb-4 text-center">
      Apply Promo Code
     </h3>
     <form class="flex space-x-3" id="promo-form">
      <input class="flex-grow border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" id="promo-code-input" placeholder="Enter promo code" type="text"/>
      <button class="bg-yellow-500 text-white px-5 py-2 rounded hover:bg-yellow-600 transition" type="submit">
       Apply
      </button>
     </form>
     <p class="mt-2 text-center font-semibold" id="promo-msg">
     </p>
    </div>
    <!-- User Reviews & Ratings -->
    <div class="bg-white rounded-lg shadow p-6 max-w-4xl mx-auto">
     <h3 class="text-xl font-bold text-blue-700 mb-6 text-center">
      User Reviews &amp; Ratings
     </h3>
     <div class="space-y-6 max-h-96 overflow-y-auto px-2" id="reviews-list">
      <!-- Reviews will be dynamically loaded here -->
     </div>
     <form class="mt-6 space-y-4 max-w-md mx-auto" id="review-form">
      <h4 class="font-semibold text-lg text-gray-800">
       Add Your Review
      </h4>
      <textarea class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none" id="review-text" placeholder="Write your review here..." required="" rows="3"></textarea>
      <div class="flex items-center space-x-3">
       <label class="font-semibold text-gray-700" for="review-rating">
        Rating:
       </label>
       <select class="border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" id="review-rating" required="">
        <option disabled="" selected="" value="">
         Select rating
        </option>
        <option value="5">
         5 - Excellent
        </option>
        <option value="4">
         4 - Good
        </option>
        <option value="3">
         3 - Average
        </option>
        <option value="2">
         2 - Poor
        </option>
        <option value="1">
         1 - Bad
        </option>
       </select>
      </div>
      <button class="bg-blue-600 text-white px-5 py-2 rounded hover:bg-blue-700 transition w-full" type="submit">
       Submit Review
      </button>
     </form>
    </div>
    <!-- FAQ Section -->
    <div class="bg-white rounded-lg shadow p-6 max-w-4xl mx-auto">
     <h3 class="text-xl font-bold text-blue-700 mb-6 text-center">
      Frequently Asked Questions
     </h3>
     <div class="space-y-4" id="faq-list">
      <details class="border border-gray-300 rounded p-4">
       <summary class="font-semibold cursor-pointer">
        How do I add money to my wallet?
       </summary>
       <p class="mt-2 text-gray-700">
        You can add money by navigating to the "Add Money" section and entering the amount you want to add.
       </p>
      </details>
      <details class="border border-gray-300 rounded p-4">
       <summary class="font-semibold cursor-pointer">
        What payment methods are supported?
       </summary>
       <p class="mt-2 text-gray-700">
        We support SSLCommerz and Stripe payment gateways. Payment methods can be updated by the admin.
       </p>
      </details>
      <details class="border border-gray-300 rounded p-4">
       <summary class="font-semibold cursor-pointer">
        How do I check my order status?
       </summary>
       <p class="mt-2 text-gray-700">
        Go to "My Orders" to see real-time status updates of your orders.
       </p>
      </details>
      <details class="border border-gray-300 rounded p-4">
       <summary class="font-semibold cursor-pointer">
        Can I get support if I face issues?
       </summary>
       <p class="mt-2 text-gray-700">
        Yes, use the WhatsApp support button at the bottom right or the live chat support feature.
       </p>
      </details>
     </div>
    </div>
   </section>
  </main>
  <!-- Support WhatsApp Button -->
  <a aria-label="Contact support on WhatsApp" class="fixed bottom-6 right-6 bg-green-500 hover:bg-green-600 text-white rounded-full p-4 shadow-lg flex items-center justify-center z-50" href="https://wa.me/8801234567890" id="whatsapp-support-btn" target="_blank">
   <i class="fab fa-whatsapp fa-2x">
   </i>
  </a>
  <!-- Live Chat Support Widget -->
  <div aria-atomic="true" aria-live="polite" class="fixed bottom-24 right-6 w-80 max-w-full bg-white rounded-lg shadow-lg border border-gray-300 hidden flex flex-col z-50" id="live-chat-widget">
   <header class="bg-blue-600 text-white px-4 py-2 flex justify-between items-center rounded-t-lg">
    <h4 class="font-semibold">
     Live Chat Support
    </h4>
    <button aria-label="Close live chat" class="hover:text-gray-300 focus:outline-none" id="live-chat-close-btn">
     <i class="fas fa-times">
     </i>
    </button>
   </header>
   <div class="flex-grow p-4 overflow-y-auto text-sm space-y-3 bg-gray-50" id="live-chat-messages">
    <p class="text-gray-600 italic">
     Support is online. How can we help you?
    </p>
   </div>
   <form class="flex border-t border-gray-300" id="live-chat-form">
    <input aria-label="Type your message" autocomplete="off" class="flex-grow px-3 py-2 focus:outline-none" id="live-chat-input" placeholder="Type your message..." required="" type="text"/>
    <button aria-label="Send message" class="bg-blue-600 text-white px-4 py-2 hover:bg-blue-700 transition" type="submit">
     <i class="fas fa-paper-plane">
     </i>
    </button>
   </form>
  </div>
  <!-- Footer -->
  <footer class="bg-gray-800 text-gray-300 mt-12">
   <div class="container mx-auto px-4 py-10 max-w-6xl grid grid-cols-1 sm:grid-cols-3 gap-8">
    <div>
     <h3 class="text-lg font-bold mb-3 text-white" id="footer-site-name">
      BULLA Top Up
     </h3>
     <p class="mb-3 italic" id="footer-slogan">
      Your trusted top-up partner
     </p>
     <p class="mb-1" id="footer-contact">
      Contact:
      <a class="hover:underline" href="tel:+8801234567890">
       +880 1234 567 890
      </a>
     </p>
     <p class="mb-1" id="footer-email">
      Email:
      <a class="hover:underline" href="mailto:support@bullatopup.com">
       support@bullatopup.com
      </a>
     </p>
    </div>
    <div>
     <h3 class="text-lg font-bold mb-3 text-white">
      Legal
     </h3>
     <ul class="space-y-2">
      <li>
       <a class="hover:underline" href="#terms">
        Terms of Service
       </a>
      </li>
      <li>
       <a class="hover:underline" href="#privacy">
        Privacy Policy
       </a>
      </li>
      <li>
       <a class="hover:underline" href="#refund">
        Refund Policy
       </a>
      </li>
     </ul>
    </div>
    <div>
     <h3 class="text-lg font-bold mb-3 text-white">
      Follow Us
     </h3>
     <div class="flex space-x-4 text-xl">
      <a aria-label="Facebook" class="hover:text-blue-500" href="https://facebook.com" target="_blank">
       <i class="fab fa-facebook-square">
       </i>
      </a>
      <a aria-label="Twitter" class="hover:text-blue-400" href="https://twitter.com" target="_blank">
       <i class="fab fa-twitter-square">
       </i>
      </a>
      <a aria-label="Instagram" class="hover:text-pink-500" href="https://instagram.com" target="_blank">
       <i class="fab fa-instagram-square">
       </i>
      </a>
      <a aria-label="LinkedIn" class="hover:text-blue-700" href="https://linkedin.com" target="_blank">
       <i class="fab fa-linkedin">
       </i>
      </a>
     </div>
     <p class="mt-6 text-sm text-gray-400">
      Developed by
      <a class="hover:underline" href="https://github.com/developer" target="_blank">
       Your Name
      </a>
     </p>
    </div>
   </div>
  </footer>
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js">
  </script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js">
  </script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js">
  </script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-functions-compat.js">
  </script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-messaging-compat.js">
  </script>
  <script>
   // Firebase config - replace with your own config
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_AUTH_DOMAIN",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_STORAGE_BUCKET",
    messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
    appId: "YOUR_APP_ID",
    measurementId: "YOUR_MEASUREMENT_ID"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();
  const functions = firebase.functions();
  const messaging = firebase.messaging();

  // Elements
  const navMenu = document.getElementById('nav-menu');
  const mobileMenuBtn = document.getElementById('mobile-menu-btn');
  const mobileMenu = document.getElementById('mobile-menu');
  const orderNotificationBadge = document.getElementById('order-notification-badge');
  const orderNotificationBadgeMobile = document.getElementById('order-notification-badge-mobile');

  const homeSection = document.getElementById('home');
  const categoryContainer = document.getElementById('category-container');
  const categoryTitle = document.getElementById('category-title');
  const uidForm = document.getElementById('uid-form');
  const uidInput = document.getElementById('uid-input');
  const uidError = document.getElementById('uid-error');
  const productList = document.getElementById('product-list');
  const categoryBackBtn = document.getElementById('category-back-btn');

  const walletSection = document.getElementById('wallet-section');
  const walletBalanceEl = document.getElementById('wallet-balance');
  const addMoneyForm = document.getElementById('add-money-form');
  const addMoneyAmount = document.getElementById('add-money-amount');
  const addMoneyMsg = document.getElementById('add-money-msg');

  const ordersSection = document.getElementById('orders-section');
  const ordersList = document.getElementById('orders-list');

  const profileSection = document.getElementById('profile-section');
  const profileName = document.getElementById('profile-name');
  const profileEmail = document.getElementById('profile-email');
  const logoutBtn = document.getElementById('logout-btn');

  const promoForm = document.getElementById('promo-form');
  const promoCodeInput = document.getElementById('promo-code-input');
  const promoMsg = document.getElementById('promo-msg');

  const reviewsList = document.getElementById('reviews-list');
  const reviewForm = document.getElementById('review-form');
  const reviewText = document.getElementById('review-text');
  const reviewRating = document.getElementById('review-rating');

  const faqList = document.getElementById('faq-list');

  const whatsappSupportBtn = document.getElementById('whatsapp-support-btn');

  const liveChatWidget = document.getElementById('live-chat-widget');
  const liveChatCloseBtn = document.getElementById('live-chat-close-btn');
  const liveChatForm = document.getElementById('live-chat-form');
  const liveChatInput = document.getElementById('live-chat-input');
  const liveChatMessages = document.getElementById('live-chat-messages');

  // Navigation mobile toggle
  mobileMenuBtn.addEventListener('click', () => {
    mobileMenu.classList.toggle('hidden');
  });

  // Navigation links
  function hideAllSections() {
    homeSection.classList.add('hidden');
    categoryContainer.classList.add('hidden');
    walletSection.classList.add('hidden');
    ordersSection.classList.add('hidden');
    profileSection.classList.add('hidden');
    promoForm.parentElement.parentElement.classList.add('hidden');
  }

  function showSection(section) {
    hideAllSections();
    section.classList.remove('hidden');
  }

  // Navigation link handlers
  function navigateTo(hash) {
    switch (hash) {
      case '#profile':
        showSection(profileSection);
        break;
      case '#orders':
        showSection(ordersSection);
        loadUserOrders();
        break;
      case '#wallet':
        showSection(walletSection);
        loadWalletBalance();
        break;
      case '#add-money':
        showSection(walletSection);
        loadWalletBalance();
        break;
      default:
        showSection(homeSection);
        break;
    }
  }

  // On page load or hash change
  window.addEventListener('hashchange', () => {
    navigateTo(window.location.hash);
  });

  // Initial navigation
  navigateTo(window.location.hash || '#home');

  // Authentication state
  let currentUser = null;
  auth.onAuthStateChanged(user => {
    currentUser = user;
    if (user) {
      profileName.value = user.displayName || '';
      profileEmail.value = user.email || '';
      // Show user nav links
      navMenu.classList.remove('hidden');
      mobileMenu.classList.remove('hidden');
      // Load wallet balance and orders count
      loadWalletBalance();
      loadPendingOrdersCount();
    } else {
      // Redirect to login page or show login modal
      // For demo, show alert and reload
      alert('Please login to access BULLA Top Up.');
      window.location.reload();
    }
  });

  logoutBtn.addEventListener('click', () => {
    auth.signOut();
  });

  // Load wallet balance
  async function loadWalletBalance() {
    if (!currentUser) return;
    try {
      const walletDoc = await db.collection('wallets').doc(currentUser.uid).get();
      const balance = walletDoc.exists ? walletDoc.data().balance : 0;
      walletBalanceEl.textContent = `৳${balance.toFixed(2)}`;
    } catch (e) {
      walletBalanceEl.textContent = '৳0.00';
    }
  }

  // Add money form submit
  addMoneyForm.addEventListener('submit', async e => {
    e.preventDefault();
    if (!currentUser) return;
    const amount = parseFloat(addMoneyAmount.value);
    if (isNaN(amount) || amount < 10) {
      addMoneyMsg.textContent = 'Minimum amount is ৳10.';
      addMoneyMsg.classList.remove('hidden');
      return;
    }
    addMoneyMsg.classList.add('hidden');
    try {
      // Simulate payment gateway success
      // In real app, integrate SSLCommerz/Stripe here
      // Update wallet balance in Firestore transactionally
      const walletRef = db.collection('wallets').doc(currentUser.uid);
      await db.runTransaction(async (transaction) => {
        const walletDoc = await transaction.get(walletRef);
        let newBalance = amount;
        if (walletDoc.exists) {
          newBalance += walletDoc.data().balance;
        }
        transaction.set(walletRef, { balance: newBalance }, { merge: true });
      });
      addMoneyMsg.textContent = `৳${amount.toFixed(2)} added successfully!`;
      addMoneyMsg.classList.remove('hidden');
      addMoneyAmount.value = '';
      loadWalletBalance();
    } catch (err) {
      addMoneyMsg.textContent = 'Failed to add money. Try again.';
      addMoneyMsg.classList.remove('hidden');
    }
  });

  // Load pending orders count for notification badge
  async function loadPendingOrdersCount() {
    if (!currentUser) return;
    try {
      const ordersSnapshot = await db.collection('orders')
        .where('userId', '==', currentUser.uid)
        .where('status', '==', 'Pending')
        .get();
      const count = ordersSnapshot.size;
      if (count > 0) {
        orderNotificationBadge.textContent = count;
        orderNotificationBadge.classList.remove('hidden');
        orderNotificationBadgeMobile.textContent = count;
        orderNotificationBadgeMobile.classList.remove('hidden');
      } else {
        orderNotificationBadge.classList.add('hidden');
        orderNotificationBadgeMobile.classList.add('hidden');
      }
    } catch (e) {
      orderNotificationBadge.classList.add('hidden');
      orderNotificationBadgeMobile.classList.add('hidden');
    }
  }

  // Load user orders
  async function loadUserOrders() {
    if (!currentUser) return;
    ordersList.innerHTML = '<tr><td colspan="6" class="text-center py-4">Loading orders...</td></tr>';
    try {
      const ordersSnapshot = await db.collection('orders')
        .where('userId', '==', currentUser.uid)
        .orderBy('createdAt', 'desc')
        .limit(20)
        .get();
      if (ordersSnapshot.empty) {
        ordersList.innerHTML = '<tr><td colspan="6" class="text-center py-4">No orders found.</td></tr>';
        return;
      }
      ordersList.innerHTML = '';
      ordersSnapshot.forEach(doc => {
        const order = doc.data();
        const date = order.createdAt ? order.createdAt.toDate().toLocaleString() : '';
        const statusColor = order.status === 'Completed' ? 'text-green-600' : 'text-yellow-600';
        ordersList.innerHTML += `
          <tr class="border-b border-gray-200 hover:bg-gray-50">
            <td class="p-3 border border-gray-200 font-mono text-xs">${doc.id}</td>
            <td class="p-3 border border-gray-200">${order.productName}</td>
            <td class="p-3 border border-gray-200 font-mono">${order.uid}</td>
            <td class="p-3 border border-gray-200">৳${order.amount.toFixed(2)}</td>
            <td class="p-3 border border-gray-200 font-semibold ${statusColor}">${order.status}</td>
            <td class="p-3 border border-gray-200">${date}</td>
          </tr>
        `;
      });
    } catch (e) {
      ordersList.innerHTML = '<tr><td colspan="6" class="text-center py-4 text-red-600">Failed to load orders.</td></tr>';
    }
  }

  // Category navigation
  const categories = {
    FreeFire: {
      title: 'Free Fire (ID CODE)',
      products: []
    },
    AirdropOffer: {
      title: 'Airdrop Offer',
      products: []
    },
    WeeklyMonthly: {
      title: 'Weekly & Monthly',
      products: []
    }
  };

  // Load products from Firestore (admin editable)
  async function loadProducts(categoryKey) {
    productList.innerHTML = '<p class="col-span-full text-center py-6 text-gray-600">Loading products...</p>';
    try {
      const productsSnapshot = await db.collection('products')
        .where('category', '==', categoryKey)
        .orderBy('name')
        .get();
      const products = [];
      productsSnapshot.forEach(doc => {
        products.push({ id: doc.id, ...doc.data() });
      });
      categories[categoryKey].products = products;
      if (products.length === 0) {
        productList.innerHTML = '<p class="col-span-full text-center py-6 text-gray-600">No products available.</p>';
        return;
      }
      productList.innerHTML = '';
      products.forEach(product => {
        const productCard = document.createElement('div');
        productCard.className = 'bg-gray-50 rounded-lg shadow p-4 flex flex-col justify-between';
        productCard.innerHTML = `
          <div>
            <h3 class="font-semibold text-lg text-gray-800 mb-2">${product.name}</h3>
            <p class="text-gray-600 mb-3">${product.description || ''}</p>
            <p class="font-bold text-blue-700 mb-3">৳${product.price.toFixed(2)}</p>
          </div>
          <button
            class="buy-btn bg-blue-600 text-white rounded px-4 py-2 hover:bg-blue-700 transition"
            data-product-id="${product.id}"
            data-product-price="${product.price}"
            data-product-name="${product.name}"
          >
            Buy Now
          </button>
        `;
        productList.appendChild(productCard);
      });
    } catch (e) {
      productList.innerHTML = '<p class="col-span-full text-center py-6 text-red-600">Failed to load products.</p>';
    }
  }

  // Show category page
  function showCategoryPage(categoryKey) {
    hideAllSections();
    categoryContainer.classList.remove('hidden');
    categoryTitle.textContent = categories[categoryKey].title;
    uidInput.value = '';
    productList.innerHTML = '';
    uidError.classList.add('hidden');
    currentCategory = categoryKey;
  }

  // Back to home categories
  categoryBackBtn.addEventListener('click', () => {
    hideAllSections();
    homeSection.classList.remove('hidden');
  });

  // Category links on home page
  document.querySelectorAll('a[href^="#category-"]').forEach(link => {
    link.addEventListener('click', e => {
      e.preventDefault();
      const catKey = e.currentTarget.getAttribute('href').replace('#category-', '');
      showCategoryPage(catKey);
    });
  });

  // UID form submit to load products
  let currentCategory = null;
  let currentUID = null;
  uidForm.addEventListener('submit', async e => {
    e.preventDefault();
    uidError.classList.add('hidden');
    const uidVal = uidInput.value.trim();
    if (!uidVal) {
      uidError.textContent = 'Please enter a valid UID.';
      uidError.classList.remove('hidden');
      return;
    }
    currentUID = uidVal;
    await loadProducts(currentCategory);
  });

  // Buy Now button click handler (delegated)
  productList.addEventListener('click', async e => {
    if (!e.target.classList.contains('buy-btn')) return;
    if (!currentUser) {
      alert('Please login to buy products.');
      return;
    }
    if (!currentUID) {
      alert('Please enter your UID first.');
      return;
    }
    const btn = e.target;
    const productId = btn.getAttribute('data-product-id');
    const productPrice = parseFloat(btn.getAttribute('data-product-price'));
    const productName = btn.getAttribute('data-product-name');

    // Check wallet balance
    try {
      const walletDoc = await db.collection('wallets').doc(currentUser.uid).get();
      const balance = walletDoc.exists ? walletDoc.data().balance : 0;
      if (balance < productPrice) {
        if (confirm('Insufficient balance. Would you like to add money?')) {
          window.location.hash = '#add-money';
          showSection(walletSection);
        }
        return;
      }
      // Deduct balance and place order atomically
      const walletRef = db.collection('wallets').doc(currentUser.uid);
      const ordersRef = db.collection('orders');
      await db.runTransaction(async (transaction) => {
        const walletSnap = await transaction.get(walletRef);
        if (!walletSnap.exists || walletSnap.data().balance < productPrice) {
          throw new Error('Insufficient balance');
        }
        const newBalance = walletSnap.data().balance - productPrice;
        transaction.update(walletRef, { balance: newBalance });
        transaction.set(ordersRef.doc(), {
          userId: currentUser.uid,
          productId,
          productName,
          uid: currentUID,
          amount: productPrice,
          status: 'Pending',
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
      });
      alert('Order placed successfully! Status: Pending.');
      loadWalletBalance();
      loadPendingOrdersCount();
      window.location.hash = '#orders';
      showSection(ordersSection);
    } catch (err) {
      alert('Failed to place order: ' + err.message);
    }
  });

  // Promo code form submit
  promoForm.addEventListener('submit', async e => {
    e.preventDefault();
    const code = promoCodeInput.value.trim().toUpperCase();
    if (!code) {
      promoMsg.textContent = 'Please enter a promo code.';
      promoMsg.classList.remove('text-green-600');
      promoMsg.classList.add('text-red-600');
      return;
    }
    try {
      const promoDoc = await db.collection('promocodes').doc(code).get();
      if (!promoDoc.exists) {
        promoMsg.textContent = 'Invalid promo code.';
        promoMsg.classList.remove('text-green-600');
        promoMsg.classList.add('text-red-600');
        return;
      }
      const promoData = promoDoc.data();
      if (!promoData.active) {
        promoMsg.textContent = 'Promo code is not active.';
        promoMsg.classList.remove('text-green-600');
        promoMsg.classList.add('text-red-600');
        return;
      }
      promoMsg.textContent = `Promo code applied! Discount: ${promoData.discount}%`;
      promoMsg.classList.remove('text-red-600');
      promoMsg.classList.add('text-green-600');
      // Store promo discount in sessionStorage for use in checkout (not implemented here)
    } catch (e) {
      promoMsg.textContent = 'Failed to validate promo code.';
      promoMsg.classList.remove('text-green-600');
      promoMsg.classList.add('text-red-600');
    }
  });

  // Load user reviews
  async function loadReviews() {
    reviewsList.innerHTML = '<p class="text-center text-gray-600 py-6">Loading reviews...</p>';
    try {
      const reviewsSnapshot = await db.collection('reviews').orderBy('createdAt', 'desc').limit(20).get();
      if (reviewsSnapshot.empty) {
        reviewsList.innerHTML = '<p class="text-center text-gray-600 py-6">No reviews yet.</p>';
        return;
      }
      reviewsList.innerHTML = '';
      reviewsSnapshot.forEach(doc => {
        const r = doc.data();
        const date = r.createdAt ? r.createdAt.toDate().toLocaleDateString() : '';
        const stars = '★'.repeat(r.rating) + '☆'.repeat(5 - r.rating);
        const userName = r.userName || 'Anonymous';
        const reviewEl = document.createElement('div');
        reviewEl.className = 'border border-gray-300 rounded p-3 bg-gray-50';
        reviewEl.innerHTML = `
          <div class="flex justify-between items-center mb-1">
            <span class="font-semibold text-gray-800">${userName}</span>
            <span class="text-yellow-500 font-bold">${stars}</span>
          </div>
          <p class="text-gray-700 mb-1">${r.text}</p>
          <small class="text-gray-500">${date}</small>
        `;
        reviewsList.appendChild(reviewEl);
      });
    } catch (e) {
      reviewsList.innerHTML = '<p class="text-center text-red-600 py-6">Failed to load reviews.</p>';
    }
  }
  loadReviews();

  // Submit review form
  reviewForm.addEventListener('submit', async e => {
    e.preventDefault();
    if (!currentUser) {
      alert('Please login to submit a review.');
      return;
    }
    const text = reviewText.value.trim();
    const rating = parseInt(reviewRating.value);
    if (!text || !rating || rating < 1 || rating > 5) {
      alert('Please provide valid review text and rating.');
      return;
    }
    try {
      await db.collection('reviews').add({
        userId: currentUser.uid,
        userName: currentUser.displayName || 'Anonymous',
        text,
        rating,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });
      reviewText.value = '';
      reviewRating.value = '';
      alert('Thank you for your review!');
      loadReviews();
    } catch (e) {
      alert('Failed to submit review.');
    }
  });

  // Live Chat Support toggle
  whatsappSupportBtn.insertAdjacentHTML('afterend', `
    <button id="live-chat-toggle-btn" aria-label="Open live chat support" class="fixed bottom-20 right-6 bg-blue-600 hover:bg-blue-700 text-white rounded-full p-4 shadow-lg flex items-center justify-center z-50">
      <i class="fas fa-comments fa-lg"></i>
    </button>
  `);
  const liveChatToggleBtn = document.getElementById('live-chat-toggle-btn');

  liveChatToggleBtn.addEventListener('click', () => {
    liveChatWidget.classList.toggle('hidden');
  });
  liveChatCloseBtn.addEventListener('click', () => {
    liveChatWidget.classList.add('hidden');
  });

  // Live chat form submit (mock)
  liveChatForm.addEventListener('submit', e => {
    e.preventDefault();
    const msg = liveChatInput.value.trim();
    if (!msg) return;
    const userMsgEl = document.createElement('p');
    userMsgEl.className = 'text-right text-blue-600';
    userMsgEl.textContent = msg;
    liveChatMessages.appendChild(userMsgEl);
    liveChatInput.value = '';
    liveChatMessages.scrollTop = liveChatMessages.scrollHeight;

    // Simulate support reply
    setTimeout(() => {
      const supportMsgEl = document.createElement('p');
      supportMsgEl.className = 'text-left text-gray-700 italic';
      supportMsgEl.textContent = 'Support: Thank you for your message. We will get back to you shortly.';
      liveChatMessages.appendChild(supportMsgEl);
      liveChatMessages.scrollTop = liveChatMessages.scrollHeight;
    }, 1500);
  });

  // Multi-language support (English + Bangla)
  // Simple toggle button in footer (not visible in UI, but can be added)
  // For demo, English only

  // Push notifications setup (requires service worker and user permission)
  // This is a placeholder for Firebase Messaging integration
  async function requestNotificationPermission() {
    try {
      await Notification.requestPermission();
      if (Notification.permission === 'granted') {
        const token = await messaging.getToken({ vapidKey: 'YOUR_VAPID_KEY' });
        console.log('FCM Token:', token);
        // Save token to Firestore for user to receive notifications
      }
    } catch (e) {
      console.warn('Notification permission denied or error:', e);
    }
  }
  // Uncomment to request permission on load
  // requestNotificationPermission();

  // Admin panel is not included here but should be a separate secured interface
  // Admin can edit products, payment methods, support number, footer info, etc.
  // All changes reflected live via Firestore
  </script>
 </body>
</html>
